<!DOCTYPE html>
<!-- saved from url=(0061)http://www.wnshop.com/index.php/Admin/goods/addEditGoods.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<!-- Apple devices fullscreen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- Apple devices fullscreen -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link href="__ADMIN__/tpcss/main.css" rel="stylesheet" type="text/css">
<link href="__ADMIN__/tpcss/page.css" rel="stylesheet" type="text/css">
<link href="__ADMIN__/tpcss/jquery-ui.min.css" rel="stylesheet" type="text/css">
<link href="__ADMIN__/tpcss/perfect-scrollbar.min.css" rel="stylesheet" type="text/css">
<style type="text/css">html, body { overflow: visible;}</style>
</script>
<link rel="stylesheet" href="__ADMIN__/imageupload/control/css/zyUpload.css" type="text/css">



<link rel="stylesheet" href="__ADMIN__/tpcss/layer.css" id="layuicss-skinlayercss">
<script src="__ADMIN__/js/jquery-1.9.1.min.js"></script>
<script src="__ADMIN__/assets/js/jquery.dataTables.min.js"></script>
<script src="__ADMIN__/assets/js/jquery.dataTables.bootstrap.js"></script>    
<script src="__ADMIN__/assets/js/bootstrap.min.js"></script>
<script src="__ADMIN__/assets/js/typeahead-bs2.min.js"></script>
<script type="text/javascript" src="__ADMIN__/js/H-ui.js"></script> 
<script type="text/javascript" src="__ADMIN__/js/H-ui.admin.js"></script> 
<script src="__ADMIN__/assets/layer/layer.js" type="text/javascript" ></script>
<script src="__ADMIN__/assets/laydate/laydate.js" type="text/javascript"></script>
<script src="__ADMIN__/js/lrtk.js" type="text/javascript" ></script>  

<script src="__ADMIN__/imageupload/core/zyFile.js"></script>
<script src="__ADMIN__/imageupload/control/js/zyUpload.js"></script>
<script src="__ADMIN__/imageupload/core/jq22.js"></script>
<style>
    ul.group-list {
        width: 96%;min-width: 1000px; margin: auto 5px;list-style: disc outside none;
    }
    ul.group-list li {
        white-space: nowrap;float: left;
        width: 150px; height: 25px;
        padding: 3px 5px;list-style-type: none;
        list-style-position: outside;border: 0px;margin: 0px;
    }
    .row .table-bordered td .btn,.row .table-bordered td img{
        vertical-align: middle;
    }
    .row .table-bordered td{
      padding: 8px;
      line-height: 1.42857143;
    }
    .table-bordered{
      width: 100%
    }
    .table-bordered tr td{
      border: 1px solid #f4f4f4;
    }
    .btn-success {
        color: #fff;
        background-color: #449d44;
        border-color: #398439 solid 1px;
    }
    .btn {
    display: inline-block;
    padding: 6px 12px;
    margin-bottom: 0;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.42857143;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    -ms-touch-action: manipulation;
    touch-action: manipulation;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-image: none;
    border: 1px solid transparent;
    border-radius: 4px;
}
.col-xs-8 {
    width: 66.66666667%;
}
.col-xs-4 {
    width: 33.33333333%;
}
.col-xs-1, .col-xs-10, .col-xs-11, .col-xs-12, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9 {
    float: left;
}
.row .tab-pane h4{
  padding: 10px 0;
}
.row .tab-pane h4 input{
  vertical-align: middle;
} 
.table-striped>tbody>tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}
.ncap-form-default .title{
  border-bottom: 0
}
.ncap-form-default dl.row, .ncap-form-all dd.opt{
    /*border-color: #F0F0F0;*/
    border: none;
}
.ncap-form-default dl.row:hover, .ncap-form-all dd.opt:hover{
    border: none;
    box-shadow: inherit;
}
</style>

<body style="background-color: rgb(255, 255, 255); overflow: auto;">
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
<div class="page">
    <div class="fixed-bar">
        <div class="item-title">
            <div class="subject">
                <h3>商城设置</h3>
                <h5>网站全局内容基本选项设置</h5>
            </div>
            <ul class="tab-base nc-row">
                <li><a href="javascript:void(0);" onclick="showxiangce()" data-index="2" class="tab"><span>商品相册</span></a></li>
                <li><a href="javascript:void(0);" onclick="showmuxing()" data-index="3" class="tab current"><span>商品模型</span></a></li>                
            </ul>
        </div>
    </div>
    <!-- 操作说明 -->
    <div class="explanation" id="explanation">
        <div class="title" id="checkZoom"><i class="fa fa-lightbulb-o"></i>
            <h4 title="提示相关设置操作时应注意的要点">操作提示</h4>
            <span id="explanationZoom" title="收起提示"></span> </div>
        <ul>
            <li>请务必正确填写商品信息</li>
        </ul>
    </div>
    <!--表单数据-->
    <form method="post" onsubmit="return false;" id="addEditGoodsForm">

<!-- 商品相册-->        
		<div class="ncap-form-default tab_div_2" style="display:none;" id="xiangce">
         
            <div style="height: 800px;border: 1px solid #f00">
                <p style="margin-left: 100px;font-size: 18px;">当前商品图片:</p>
                <div>
                    {foreach $imginfo as $v}
                        <img src="{$v['image_url']}" width="140" style="">
                    {/foreach}
                </div>
                <div id="demo" class="demo" style="height: 500px;"></div>

            </div>
        </div>   
<!-- 商品相册-->
<!-- 商品模型-->
		<div class="ncap-form-default tab_div_3" style="" id="moxing">
            <dl class="row">
                <div class="tab-pane" id="tab_goods_spec">
                    <table class="table table-bordered" id="goods_spec_table">    
                        <tbody><tr>
                            <td>商品模型:</td>
                            <td>                                        
                              <select id="spec_type" name="gtype_id" class="form-control" style="width:250px;">
                                <option value="0">选择商品模型</option>
                                {foreach $type as $v}
                                   <option value="{$v['id']}"  {if $v['name'] == $typename} selected {/if}>{$v['name']}</option> 
                                {/foreach}
                              </select>
                              <input type="hidden" id="goodsid" value="{$goodsid}">
                            </td>
                        </tr>                            
                        </tbody>
                    </table>
                    <div class="row">
                    	<!-- ajax 返回规格-->
                    	<div id="ajax_spec_data" class="col-xs-8"><table class="table table-bordered" id="goods_spec_table1">                                
    <tbody id="addspec">
        <tr>
            <td colspan="2"><b>商品规格:</b></td>
        </tr>
        
        {foreach $spec2 as $k => $v2}
            <tr>
                <td>{$v2['name']}</td>
                <td>
                {foreach $spec as  $v}
                 
                    {if $v['name'] == $v2['name']}
                        
                        <button type="button"  class="{if in_array($v['item_id'],$gitm)}btn btn-success{else}btn btn-default{/if}"><em style="color:red">[{$v['item_id']}]</em>{$v['item']}</button> 
                        <img onclick="addxiang()" width="35" height="35" src="__ADMIN__/tpcss/add-button.jpg" id="item_img_11">
                        &nbsp;&nbsp;&nbsp;
                    {/if}
                  
                {/foreach}
                </td></tr>
        {/foreach}

    </tbody>
</table>
    <div id="goods_spec_table2">
        <table class="table table-bordered" id="spec_input_tab">
            <tbody id="afterthis">
                <tr > 
                    <td>
                       <b>请填写规格前的ID值 按照ID-ID-ID格式</b>
                    </td>
                    <td>
                        <b>价格</b>
                    </td>
                   <td>
                        <b>库存</b>
                    </td>
                </tr>
               
                {foreach $spec_goods as $v}
                <tr class="spec_goods"> 
                 
                    <td>
                       <input type="text" name="key[]" value="{$v['key']}" style="width: 400px;">
                    </td>
                    <td>
                      <input type="text" name="price[]" value="{$v['price']}">
                    </td>
                   <td>
                      <input type="text" name="store_count[]" value="{$v['store_count']}">
                    </td>
                </tr>
                {/foreach}
            </tbody>
        </table>
    </div>

 </div>
    	<div id="" class="col-xs-4">
    	    <table class="table table-bordered" id="goods_attr_table">                                
                <tbody id="tbodyaddtype">
                    <tr>
                        <td><b>商品属性</b>：</td>
                    </tr>                        
                    {foreach $attr as $v}
                    <tr>
                        <td>{$v['attr_name']}</td>
                        {if $v['attr_input_type'] == 1}
                            <td><select name="attr_values[{$v['attr_id']}]">
                                {foreach $v['attr_values'] as $a}
                                <option value="{$a}" {if $v['attr_value'] == $a} selected {/if}>{$a}</option>
                                {/foreach}
                            </select></td>  
                        {else}
                            <td><input type="text" size="40" value="{$v['attr_value']}" name="attr_values[{$v['attr_id']}]"></td>
                        {/if} 
                        
                    </tr>
                    {/foreach}

                </tbody>
            </table>
        </div>
    </div>
</div>
                
</dl>             
</div>   
<!-- 商品模型-->         
        <div class="ncap-form-default">        
            <div class="bot">          
                <a href="JavaScript:;" class="ncap-btn-big ncap-btn-green" id="submit">确认提交</a> 
            </div>
        </div> 
    </form>
    <!--表单数据-->
</div>
<div id="goTop" style="bottom: -156px;"> <a href="JavaScript:void(0);" id="btntop"><i class="fa fa-angle-up"></i></a><a href="JavaScript:void(0);" id="btnbottom"><i class="fa fa-angle-down"></i></a></div>
<script>

    var goodsid = $('#goodsid').val();

  
    $('#submit').on('click',function () {
        var formData = new FormData($( "#addEditGoodsForm" )[0]); 
        $.ajax({  
          url: 'editGoodsModel.html?id='+goodsid,  
          //url: '{:url("editGoodsModel")}',  
          type: 'POST',  
          data: formData,  
          async: true,  
          cache: false,  
          contentType: false,  
          processData: false,  
          success: function (data) {
            if (data == 1) {
                layer.alert('更改成功');
            } else {
                layer.alert('更改失败',{'icon':2});
            }
          }
        });  
    });
     





    function showmuxing() {
        $('#moxing').css('display','block');
        $('#xiangce').css('display','none');
    }
    function showxiangce() {
        $('#xiangce').css('display','block');
        $('#moxing').css('display','none');
    }
/*<tr class="attr_58">
    <td> 尺寸体积</td> 
    <td><input type="text" size="40" value="   " name="attr_58[]"></td>
</tr>
<tr class="attr_59">
    <td> 外观样式/手机类型</td> 
    <td>
        <select name="attr_59[]">
            <option value="翻盖">翻盖</option>
            <option value="滑盖">滑盖</option>
            <option value="直板">直板</option>
            <option value="折叠">折叠</option>
            <option value="手写">手写</option>
        </select>
    </td>
</tr>
*/

/* <tr>
    <td>网络:</td>
    <td>                            
        <button type="button" data-spec_id="5" data-item_id="11" class="btn btn-default">4G</button> 
        <img width="35" height="35" src="__ADMIN__/tpcss/add-button.jpg" id="item_img_11">    
        <input type="hidden" name="item_img[11]" value="">                                                      
        &nbsp;&nbsp;&nbsp;  

        <button type="button" data-spec_id="5" data-item_id="12" class="btn btn-default">3G</button><img width="35" height="35" src="__ADMIN__/tpcss/add-button.jpg" id="item_img_12">    
        <input type="hidden" name="item_img[12]" value="">                                                      
        &nbsp;&nbsp;&nbsp;            
     
    </td>
</tr>       */

    $('#spec_type').on('change',function () {
        var typeid = $('#spec_type option:selected').val();

        $.get('{:url("goods/getmodelbyid")}',{"id":typeid},function (data) {
            $('#tbodyaddtype').empty('tr td');
            $('#addspec').empty('tr td');
            $('.spec_goods').remove();
            var type = data.type;
            var spec = data.spec;
            var spec2 = data.spec2;

            $('#tbodyaddtype').append('<tr><td><b>商品属性</b>：</td></tr> ');  
            $('#addspec').append('<tr><td><b>商品规格</b>：</td></tr> ');

            for(var n in spec2) {
                var str = '<tr><td>'+spec2[n].name+'</td><td>';
                for(var m in spec){
                    if (spec[m].name == spec2[n].name) {
                        str += '<button type="button" id="'+spec[m].id+'" class="btn btn-default"><em style="color:red">['+spec[m].item_id+']</em>'+spec[m].item+'</button>'; 
                        str += '<img onclick="addxiang()" width="35" height="35" src="__ADMIN__/tpcss/add-button.jpg" id="item_img_11">';
                        str += '&nbsp;&nbsp;&nbsp;';
                    }
                }
                str += '</td></tr>';
               
                $('#addspec').append(str); 
                
            }

            for(var i in type){
                var str = '<tr>';
                    str += '<td> '+type[i].attr_name+'</td>';
                    if(type[i].attr_input_type == 1){
                        str += '<td><select name="attr_values['+type[i].attr_id+']">';
                        for(var j in type[i].attr_values){
                            str += '<option value="'+type[i].attr_values[j]+'">'+type[i].attr_values[j]+'</option>';
                        }
                        str += '</select></td>';
                    } else {
                        str += '<td><input type="text" size="40" value="" name="attr_values['+type[i].attr_id+']"></td>';
                    } 
                    str += '</tr>';
                 $('#tbodyaddtype').append(str); 
                
            }
           
           
        },'json');
    });

    function addxiang ()
    {
        var str = '<tr class="spec_goods"><td><input type="text" name="key[]" value="" style="width: 400px;"></td><td><input type="text" name="price[]" value=""></td><td><input type="text" name="store_count[]" value=""></td></tr>';
        $('#afterthis').append(str);
    }

</script>		

</body></html>